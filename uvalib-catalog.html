<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../uvalib-api/uvalib-api.html">

<!--
Element providing an easy component access to the uva library's catalog.

##### Example

    <uvalib-catalog></uvalib-catalog>

@element uvalib-catalog
@blurb Element providing an easy component access to the uva library's catalog.
@status alpha
@homepage http://uvalib-components.github.io/uvalib-catalog
-->
<polymer-element name="uvalib-catalog" attributes="auto count facets items">
  <template>
    <uvalib-api on-uvalib-api-load="{{apiLoaded}}"></uvalib-api>
  </template>
  <script>
    Polymer({
      /**
       * The `auto` attribute set to true means that the catalog will be queried 
       * whenever a request attribute is changed.
       *
       * @attribute auto
       * @type bool
       * @default false
       */
      auto: false,

      /**
       * The `count` attribute is set to the total query result count from the 
       * catalog once a request has been fetched
       *
       * @attribute count
       * @type string
       * @default null
       */
      count: null,

      /**
       * The `facets` attribute is set with the facet counts for a catalog request
       *
       * @attribute facets
       * @type object
       * @default null
       */
      facets: null,

      /**
       * The `items` attribute is set with the results for a catalog request
       *
       * @attribute items
       * @type array
       * @default null
       */
      items: null,

      /**
       * The `api` property is set to the Library's client catalog api once loaded
       *
       * @attribute api
       * @type object
       * @default null
       */
      api: null,

      apiLoaded: function (e) {
        this.api = e.detail.catalog;
        if (this.auto)
          this.fetch();
      },

      /**
       * The `fetch` method will make a query request against the catalog.
       *
       * @method fetch
       */
      fetch: function () {
        this.api.search({}).execute( this.parseResults.bind(this) );
      },

      /**
       * The `uvalib-catalog-fetched-results` event is fired whenever we
       * call fetch and process the results.
       *
       * @event uvalib-catalog-fetched-results
       */

      parseResults: function(results){
        this.count = results.count;
        this.items = results.items;
        this.facets = results.facets;
        this.fire('uvalib-catalog-fetched-results');
      }
      
    });
  </script>
</polymer-element>
